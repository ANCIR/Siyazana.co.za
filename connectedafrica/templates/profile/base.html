{% extends "layout.html" %}
{% from "macros/profiles.html" import render_relation, render_property %}

{% block title %}{{ display_name }}{% endblock %}

{% block description %}
  {% if entity.properties.tagline %}
    {{ entity.properties.tagline.value | truncate }}
  {% elif entity.properties.summary %}
    {{ entity.properties.summary.value | truncate }}
  {% endif %}
{% endblock %}

{% block content %}
<div class="profile">

  <div class="row header">
    <div class="col-md-12">

      {% if properties.image_full %}
        <div class="pull-left">
          <img src="{{ entity | portrait_url }}" class="profile-image" alt="{{ display_name }}">
        </div>
      {% endif %}
      <h1>
        {% block displayname %}{{ display_name }}{% endblock %}
      </h1>
      <p class="subtitle">
        {% block subtitle %}{{ render_property(entity, 'tagline', source_map) }}{% endblock %}
      </p>

    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      {% block rightpanel %}
      {% block bio %}
      <div id="bio">
        <h4>Details</h4>
        <p class="summary">
          {% block biotext %}
          {% if 'summary' in entity.properties %}
            {% if entity.properties.summary.value|length > 255 %}
              <span class="truncated">{{ entity.properties.summary.value|truncate }}<br/><a href="#" onclick="$('#bio .summary .truncated').hide(); $('#bio .summary .complete').show(); return false;">Show more</a></span>
              <span class="complete" style="display: none;">{{ entity.properties.summary.value }}<br/><a href="#" onclick="$('#bio .summary .truncated').show(); $('#bio .summary .complete').hide(); return false;">Show less</a></span>
            {% else %}
              {{ entity.properties.summary.value }}
            {% endif %}
          {% endif %}
          {% endblock %}
        </p>
        <table class="table">
          {% for property in properties %}
            <tr>
              <th>{{property.label}}:</th>
              <td>{{property.value}}</td>
            </tr>
          {% endfor %}
        </table>

        <div id="related-entities" class="text-center">
          {% block relatedentities %}{% endblock %}
        </div>
      </div>
      {% endblock %}

      <h4>Filter relationships</h4>
      <ul class="list-group">
        {% for schema_name, count in relations.schemata_counts.items() %}
          {% set schema = relations.schemata.get(schema_name) %}
          {% set active = schema.name in relations.schemata_filters %}
          <li class="list-group-item {% if active %}active{% endif %}">
          <a {% if not active %}href="{{ query_replace('schema', schema.name) }}"
             {% else %}href="{{ query_remove('schema', schema.name) }}"{% endif %}>
             {{ schema.meta.plural or schema.label }}</a>
             <span class="count badge">{{count}}</span>
           </li>
        {% endfor %}
      </ul>

      {% block sources %}
      <div id="sources">
        <h4>Sources</h4>
        <ol>
          {% for source, n in source_map.iteritems() %}
            <li id="source-{{ n }}"><a href="{{ source }}">{{ source |
              source_readable }}</a></li>
          {% endfor %}
        </ol>
      </div>
      {% endblock %}
      {% endblock %}
    </div>

    <div class="col-md-8">
    {% block centerpanel %}
      <h4>
        Relationships
        <small>
          <a href="#">by time</a>
          |
          <a href="#">by type</a>
        </small>
      </h4>

      {% block timeline %}
        <div class="relations">
          {% for group, items in relations.relations %}
            <div class="section">
              <div class="section-heading">{{ group }}</div>
              {% for item in items %}
                {{ render_relation(item) }}
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      {% endblock %}
    {% endblock %}
    </div>
  </div>
</div>
 
{% endblock %}
