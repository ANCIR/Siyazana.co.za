{% extends "layout.html" %}
{% from "macros/profiles.html" import render_relation, render_property %}

{% block title %}{{ display_name }}{% endblock %}

{% block content %}
<div class="profile">

  <div class="row header">
    <div class="col-md-12">
      {% if entity.properties.image_full %}
        <div class="pull-left">
          <img src="{{ entity | portrait_url }}" class="profile-image" alt="{{ display_name }}">
        </div>
      {% endif %}
      <h1>
        {% block displayname %}{{ display_name }}{% endblock %}
      </h1>
      <p class="subtitle">
        {% block subtitle %}{{ render_property(entity, 'tagline', source_map) }}{% endblock %}
      </p>
    </div>
  </div>

  <div class="row">
    <div class="col-md-4">
      {% block rightpanel %}
      {% block bio %}
      <div id="bio">
        <h4>Details</h4>
        <p class="summary">
          {% block biotext %}
          {% if 'summary' in entity.properties %}
            {% if entity.properties.summary.value|length > 255 %}
              <span class="truncated">{{ entity.properties.summary.value|truncate }}<br/><a href="#" onclick="$('#bio .summary .truncated').hide(); $('#bio .summary .complete').show(); return false;">Show more</a></span>
              <span class="complete" style="display: none;">{{ entity.properties.summary.value }}<br/><a href="#" onclick="$('#bio .summary .truncated').show(); $('#bio .summary .complete').hide(); return false;">Show less</a></span>
            {% else %}
              {{ entity.properties.summary.value }}
            {% endif %}
          {% endif %}
          {% endblock %}
        </p>
        <p>
          {% block basicinfo %}
          <strong>Types: </strong>{{ schemata_map.values()|join(', ') }}<br/>
          {% for k, v in entity.properties.iteritems() %}
            <strong>{{ k|capitalize }}: </strong>{{ v.value }}<br/>
          {% endfor %}
          {% endblock %}
        </p>
        <div id="related-entities" class="text-center">
          {% block relatedentities %}{% endblock %}
        </div>
      </div>
      {% endblock %}

      {% block sources %}
      <div id="sources">
        <h4>Sources</h4>
        <ol>
          {% for source, n in source_map.iteritems() %}
            <li id="source-{{ n }}"><a href="{{ source }}">{{ source |
              source_readable }}</a></li>
          {% endfor %}
        </ol>
      </div>
      {% endblock %}
      {% endblock %}
    </div>

    <div class="col-md-8">
    {% block centerpanel %}
      <div>
        {% block filters %}
          <ul id="filters" class="nav nav-pills">
            {% for schema in relations.schemata %}
              {% set active = schema.name in relations.active_schemata %}
              <li class="{% if active %}active{% endif %}">
              <a {% if active %}href="{{ query_add('schema', schema.name) }}"
                 {% else %}href="{{ query_remove('schema', schema.name) }}"{% endif %}>
                 {{ schema.meta.plural or schema.label }}</a></li>
            {% endfor %}
          </ul>
        {% endblock %}
      </div>

      {% block timeline %}
        <div class="relations">
          {% for rel in relations.non_temporal %}
            {{ render_relation(rel) }}
          {% endfor %}
          {% for group in relations.temporal|groupby('properties.date_start.value.year')|reverse %}
            <div class="text-right">
              <h3>
                <span class="label label-default">{{ group.grouper }}</span>
              </h3>
            </div>
            <hr/>
            {% for rel in group.list %}
              {{ render_relation(rel) }}
            {% endfor %}
          {% endfor %}
        </div>
      {% endblock %}
    {% endblock %}
    </div>
  </div>
</div>
 
{% endblock %}
